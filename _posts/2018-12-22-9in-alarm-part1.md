---
layout: post
title: 교내 커뮤니티 구인 알람 개발기 Part1 - 프로젝트 요구사항 정의  
---

한창 열심히 용돈을 벌기 위해서 교내 커뮤니티의 구인란을 뒤지던 때가 있었다. 아래 사진은 24일자로 올라온 글들을 캡쳐한 것인데 피실험자 모집부터 통번역 등 다양한 일들이 올라온다. 하루에 평균 5~13건 정도 글이 올라오는 꽤 활발한 게시판이라 할 수 있겠다. 문제는 자주 꿀잡들이 올라오는데 선착순인 경우가 태반. (남들 다 신청했는데 내가 못하면 배가 아프다)  

<p align="center" style="color:#808080"> 
<img src="https://heartcored98.github.io/post_src/9in-alarm/ara_page.PNG" width="1198"> <br>   
<font size="2.5">교내 커뮤니티 '아라'의 구인란</font>  
</p>

그래서 누구보다 빠르게 신청하기 위해서 직접 메신저 알람을 만들기로 했다. 그리고 이왕 만들거 다른 학우들과 같이 쓰면 좋으니까 제대로 만들기로 했다. 이런 취지로 약 3개월 전쯤에 실제로 만든 후 카대전에 홍보했더니 나의 구인 채널에는 약 97명의 가난한 학우들이 모여들었다.  

난생 처음 다른 사람들이 내 서비스를 쓰는 일이라 마음이 두근두근하던 와중. 서비스를 일주일만에 종료할 수 밖에 없었다.  

<p align="center" style="color:#808080"> 
<img src="https://heartcored98.github.io/post_src/9in-alarm/service_fail.png" width="300"> <br>   
<font size="2.5">야심차게 시작했으나.. 일주일만에 대참사!</font>  
</p>
 
<p align="center" style="color:#808080"><b>·&nbsp;&nbsp;&nbsp;&nbsp;·&nbsp;&nbsp;&nbsp;&nbsp;·</b><br></p>  

당시 0.1초라도 빨리 알람을 받아야겠다는 마음으로 초당 30번의 페이지 모니터링을 걸어뒀던터라 한번 문제가 생기면 초당 30번의 에러가 발생하였고 그 때문에 Ubuntu의 ```Serivce```가 비정상적인 서비스로 인식하고 재부팅을 포기하는 현상을 볼 수 있었다. 이후 학기가 바빠지는 바람에 디버깅을 접고 잠수를 탈 수 밖에 없었다.    


      
 
      

## 왜 다시 만드는가?  

돈이 없어졌기 때문이다. ~~(자낳괴 공돌이 씁흑흑)~~  방학 때 다시 일을 하기 위해선 이런 자동화된 알람으로 무장할 필요가 있었다.  

둘째로는 3개월 전에 일주일 후에 돌아오겠다는 말을 하고 사라진 것에 대한 책임을  지기 위해서이다.    

## 프로젝트 디자인  

#### 서비스 구성은?  

기획 중인 서비스 플로우차트는 다음과 같다.  
1. 교내 커뮤니티 중 구인란인 https://ara.kaist.ac.kr/board/Wanted 에 접속 후 게시글 목록을 따온다.  
2. 마지막으로 업데이트 된 게시글 목록과 비교하여 새로운 글을 추린다.  
3. 추려진 글들을 하나씩 접속해서 미리보기 텍스트를 추출한다.  
4. 알람으로 보낼 게시글의 제목과 미리보기 내용을 텔레그램 푸셔에 전송한다.  
5. 텔레그램 푸셔는 등록해놓은 구인 채널로 푸쉬 알림을 보내면 끝!  


<br>
#### 서버는 어디에?   
 
저번 버전에서는 한달에 약 3.5달러 밖에 과금이 되지 않는 AWS의 [LightSail](https://aws.amazon.com/ko/lightsail/) 서버를 한 대 빌려서 사용했었는데, 돈 벌자고 만드는건데 월 지출이 발생하는 것도 그렇고 요즘 대세인 PasS를 시도해보고 싶어서 이번엔 AWS의 [Lambda](https://aws.amazon.com/ko/lambda/) 함수 형태로 만들어서 1분에 한번씩 호출하기로 했다.  

Lambda 서비스는 한달에 약 1백만회까지 요청이 무료라서(고마워요 AWS!) 호출 주기가 1분이면 월 약 43,000회 정도의 호출이 발생하므로 돈을 한 푼도 안 쓰고 서비스가 가능하다.       

    
<br>
#### 구현은 어떻게?  
앞서 언급한 다섯 가지의 서비스 구성 요소들을 어떻게 구현할지 하나씩 생각해보았다.  

1번의 경우 해당 링크가 퍼블릭이기 때문에 파이썬의 ```request``` 모듈 등을 활용해서 html을 긁어오고 ```beautifulsoup```을 이용해서 Table 파싱을 하면 될 것 같다.  

2번의 경우는 일반적인 서버라면 마지막 게시글 리스트를 임시 파일로 저장하거나 메모리에 계속 저장해놓고 비교할 수 있지만 Lambda의 경우 매 호출 시 초기화 되기 때문에 내부 변수를 선언하더라도 사용할 수 없게 된다. 이에 대한 대안 몇가지를 적어봤다.  

- [S3](https://aws.amazon.com/ko/s3/)에 게시글 상태를 ```.txt```나 ```.csv``` 형태로 매 호출이 끝날 때 저장하고 호출이 시작될 때 다시 로딩해온다.  
- [ElastiCache](https://aws.amazon.com/ko/elasticache/)를 활용해서 캐시 서버를 만든다. (너무 비싸고 높은 응답속도도 필요 없는 상황이므로 배제한다.)
- [DynamoDB](https://aws.amazon.com/ko/dynamodb/)나 [RDS](https://aws.amazon.com/ko/rds/?nc2=h_m1) 등의 서비스를 이용해서 게시글들에 대한 DB를 구축한다.  

이번 프로젝트는 최소 비용, 최대 성과가 목표이므로 가볍게 S3 버켓에 게시글들에 대한 ```pandas``` 데이터프레임을 ```.csv``` 형태로 저장하기로 했다.  

3번의 경우는 글의 내용을 보려면 사이트에 로그인을 해야 하는데 이를 자동화시키기 위해서는 2가지 방법이 있는데 후자를 먼저 시도해보고 정 안되면 전자의 방식을 택하기로 했다.  

- ```Selenium```을 사용해서 가상 웹 드라이버를 만들고 로그인을 한 후에 게시글을 열람한다.  
    - 장점: 가장 쉽고 확실하게 작동함
    - 단점: ChromeDriver를 사용해야 하며 Lambda에 패키지로 만들어서 올리기가 힘들며 쓸데 없이 리소스를 많이 먹음
- ```Request``` 모듈의 ```Session```을 활용해서 로그인 상태를 유지한다.  
    - 장점: 적은 리소스와 패키지만으로도 구현 가능
    - 단점: 페이지 내에서 로그인 기작이 어떤 식으로 일어나는지 네트워크를 분석해볼 필요가 있다.  
    
4,5번의 경우는 저번 버전에서도 사용했던 텔레그램 파이썬 모듈인 ```telegram```을 사용하기로 했다.

올해를 넘기면 귀차니즘이 너무 세져버리므로 3~4일 내에 조져보도록 한다.  



<p align="center" style="color:#808080"><b>·&nbsp;&nbsp;&nbsp;&nbsp;·&nbsp;&nbsp;&nbsp;&nbsp;·</b><br></p>  

<p align="right" style="color:#808080"> 
<font size="2.5">이 글은 Part2에서 이어집니다.</font>  
</p>

